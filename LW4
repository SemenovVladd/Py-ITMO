import timeit
import matplotlib.pyplot as plt
from functools import lru_cache

# импортируем библиотеки

# 1)вычисление факториала через рекурсию
@lru_cache(maxsize=None)
# Убираем кэширование, для правдоподобного сравнения
def fact_rec(n):
    if n == 0:
        return 1
    # n - значение числа факториала, которого хотим вычислить
    return fact_rec(n - 1) * n
    # возвращаем через рекурсию значение факториала

# 2)вычисление факториала без рекурсии
def fact_not_rec(n):
    c = 1
    #заводим счетчик
    for i in range(1, n + 1):
        c *= i
        #начинаем перемножать числа с 1, заканчиваем n (само n+1 не входит)
    return c
    #возвращаем значение факториала

def time_func(func, n, repeats=5):
    #функиця для измерения времени выполнения другой функции
    #func - сама функция, которую будем тестировать
    #n - значение, которое принимает функция
    #repeats - количество повторений
    timer = timeit.Timer(lambda: func(n))
    # объект таймера, который принимает функцию с числом внутри нее(для этого использовал lambda, иначе не работало)
    times = timer.repeat(repeat=repeats, number=1000)
    #измеряем время
    return (times[repeats//2+1])
    # возвращаем среднее время среди 5 (в данном случае) больших повторений


max_n = 200
#до какого числа будем измерять факториал
t_fact_rec = []
#массив для время функции через рекурсию
t_fact_not_rec = []
#массив для время функции без рекурсии

for n in range(max_n):
    #проходимся по значениям от 1 до 200
    t = time_func(fact_rec, n)
    t_fact_rec.append(t)
    #вычисляем время и записываем в массив

    t = time_func(fact_not_rec, n)
    t_fact_not_rec.append(t)
    #вычисляем время и записываем в массив


# Построение графика
plt.figure(figsize=(8, 6))
plt.plot(t_fact_rec, label="fact_rec")
plt.plot(t_fact_not_rec, label="fact_not_rec")
#строим сами графики
plt.xlabel("n")
plt.ylabel("Время выполнения функции")
#подписываем их
plt.title("Сравнение времени вычисления факториала")
#называем сам плот
plt.legend()
#добавляем легенду
plt.grid(True)
#сетка для наглядности
plt.tight_layout()
plt.show()

print(time_func(fact_rec, 150))
#пример для конкретного значения (0.0003863000001729233)
print(time_func(fact_not_rec, 150))
#пример для конкретного значения (0.016563700000006065)
